
<!DOCTYPE html>
<html lang="en">
<head>
  <script src="https://blog.zhenbo.pro/js/theme.min.js" integrity="sha384-pb++s6uBRKaQv+iAXpgA/H3IlpLZdO14tTwuCI7uXmz4aaZdByoCcM+6BhynMq/1"></script>
  <link rel="stylesheet" href="https://blog.zhenbo.pro/abridge.css?h=d6d42eaae519f2454d3a" />
  <meta charset="utf-8" />
  <meta http-equiv="x-ua-compatible" content="ie=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="base" content="https://blog.zhenbo.pro" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <meta name="theme-color" content="#333333" />
  <meta name="msapplication-TileColor" content="#333333" />
  <link rel="manifest" href="https://blog.zhenbo.pro/manifest.min.json" />
  <link rel="mask-icon" href="https://blog.zhenbo.pro/safari-pinned-tab.svg" color="#ff9900" />
  <link rel="apple-touch-icon" sizes="180x180" href="https://blog.zhenbo.pro/apple-touch-icon.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="https://blog.zhenbo.pro/favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="https://blog.zhenbo.pro/favicon-16x16.png" />
  <link rel="alternate" type="application/atom+xml" title="Blog of Endle Atom Feed" href="https://blog.zhenbo.pro/atom.xml" />
  <meta name="robots" content="index, follow" />
  <meta name="googlebot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" />
  <meta name="bingbot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" />
  <title>初探 Z function 处理字符串 | Blog of Endle</title>
  <meta name="author" content="Zhenbo Li" />
  <meta name="copyright" content="Blog of Endle" />
  <meta name="description" content="Endle&#x27;s Blog. Since 2014." />
  <link rel="canonical" href="https://blog.zhenbo.pro/string-z-function-intro/" />
  <meta property="og:url" content="https://blog.zhenbo.pro/string-z-function-intro/" />
  <meta name="twitter:url" content="https://blog.zhenbo.pro/string-z-function-intro/" />
  <meta property="og:description" content="Endle&#x27;s Blog. Since 2014." />
  <meta name="twitter:description" content="Endle&#x27;s Blog. Since 2014." />
  <meta property="og:title" content="初探 Z function 处理字符串 | Blog of Endle" />
  <meta name="twitter:title" content="初探 Z function 处理字符串 | Blog of Endle" />
  <meta name="twitter:card" content="summary" />
  <meta property="og:site_name" content="Blog of Endle" />
  <meta property="og:locale" content="en_US" />
  <meta property="og:type" content="website" />
  <meta property="og:updated_time" content="2021-06-20" />
  <script defer src="https://blog.zhenbo.pro/js/abridge.min.js?h=e0f9a881a665c86cce9c" integrity="sha384-QF67y7RnPkuDrJNQqn3/7nYxqxWkW/qHI7zN0WTES1aXbf+TotoByRBb835fUE6U"></script>
  <noscript><link rel="stylesheet" href="https://blog.zhenbo.pro/nojs.css" /></noscript><script>
MathJax = {
  tex: {
    inlineMath: [['$', '$'], ['\\(', '\\)']]
  },
  svg: {
    fontCache: 'global'
  }
};
</script>
<script type="text/javascript" id="MathJax-script" defer
  src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-svg.js">
</script>

  
</head>
<body>
  <header>
    <nav>
      <div><big><a href="https://blog.zhenbo.pro" title="Blog of Endle">Blog of Endle</a></big></div>
      <div>

        <div>
          <ul><li><a class="s110" href="https://blog.zhenbo.pro/archive/"> Posts </a></li><li><i type="reset" id="mode" class="js svgs adjust"></i></ul>
        </div>

        <div>
          <div>
            <form autocomplete=off class="js" name="goSearch" id="searchbox">
              <div class="searchd">
                <input id="searchinput" type="text" placeholder="Search" title="Search" />
                <button type="submit" title="Search" class="svgs svgm search"></button>
              </div>
              <div class="results"><div id="suggestions"></div></div>
            </form>
          </div>
        </div>

      </div>
    </nav>
  </header>
  <main>
    <article>
      <h1><a href="https://blog.zhenbo.pro/string-z-function-intro/">初探 Z function 处理字符串</a></h1>

      <span class="s95"> Zhenbo Li <span class="rpad"></span> June 20, 2021 <span class="rpad"></span></span>

    


<p>之前参加了 <a rel="noopener" target="_blank" href="https://codeforces.com/blog/entry/91381">Codeforces Round #726</a>，E2 这道题方法很多，推荐的方法是 Z Function. 我也借机学习一个新算法。</p>
<h4 id="han-shu-ding-yi">函数定义</h4>
<p>本文中，所有的数组下标均为 0 开始。如无说明，所有的区间均为闭区间。对于字符串 S, <code>S[a, b]</code> 表示选取一个长度为 <code>b - a + 1</code>，范围是由 a 到 b 的子串。</p>
<p>函数 Z 的定义是，给定一个字符串 S. 对于每个下标 i，寻找一个最长的子串使 <code>S[i,i+Zi - 1] = S[0, Zi - 1]</code>. <code>Z[0]</code> 未被定义。如果 <code>S[i] != S[0]</code>，我们有 <code>Z[i] = 0</code></p>
<p>直观一些的理解是，一个序列的前缀 (prefix) 在可能在这个序列中重复出现。例如，<a rel="noopener" target="_blank" href="https://en.wikipedia.org/wiki/Open_reading_frame">Open reading frame</a> 中，特定的密码子会在碱基序列的起始和前端重复出现。Z-function 反应了重复出现的情况。</p>
<p>我手绘了一张示意图，相同颜色表示重复的元素。向下延伸的部分，表示 <code>S[i, i+Zi - 1] = S[0, Zi - 1]</code>，也就是与前缀重合的部分。</p>
<p><img src="/images/algorithm/strings/z_function_drawing.png"
     alt="z-function-drawing"
     width="100%"></p>
<h4 id="xian-xing-shi-jian-qiu-jie">线性时间求解</h4>
<p>根据定义，可以容易地写出一个 Brute-force 的算法，求出序列 S 对应的 Z. 但当序列 S 的前缀在序列中多次重复出现时，耗时会快速增加。极端情况下，<code>aaaaa</code> 这类序列，会达到 Brute-force 算法的最坏时间复杂度，<code>O(n^2)</code>.</p>
<p>通常提到 Z Function 的时候，都是要在线性时间内求出结果。我们可以使用 Sliding Window Technique，维护一个与 S 的前缀相同的 window. 其范围是 <code>[L, R]</code> 。也就是说，这个 window:</p>
<ol>
<li><code>L &gt; 0</code></li>
<li><code>S[0, R - L] = S[L, R]</code></li>
</ol>
<p>L 与 R 均保持递增，易证算法的时间复杂度为 <code>O(n)</code></p>
<p>求 <code>Z[i]</code> 时，</p>
<ol>
<li>若 <code>i &gt; R</code>，则这个 window 没有为我们提供已知的信息。令 <code>L = R = i</code>，再向右尽可能地延伸 R</li>
<li>若 <code>i &lt;= R</code>，我们将 <code>S[L, R]</code> 拆分成 <code>S[L, i]</code> 和 <code>S[i, R]</code> (有意重叠<code>S[i]</code>)
<ul>
<li>令 <code>k = i - L</code>. 因为 <code>S[0, R-L] = S[L, R]</code>， 我们可证 <code>S[0, k] = S[L, i]</code>。</li>
<li>同理，<code>S[k, R - L] = S[i, R]</code>. 这样，我们就用上了 window 内的信息。</li>
<li>如果 <code>Z[k] &lt; R - i + 1</code> ，就说明在子串 <code>S[k, R - L]</code> 中存在 <code>p &gt;= Z[k]</code>, 使 <code>S[k+p] != S[0+p]</code>。 这也就是说， <code>S[i+p] != S[p]</code>。同样，对于任意 <code>q &lt; Z[k]</code>，我们有 <code>S[i+q] = S[k+q] = S[q]</code>。因此，<code>Z[i] = Z[k]</code></li>
<li>如果 <code>Z[k] &gt;= R - i + 1</code>，我们在保持 L 不变的基础上，尽可能延伸 R</li>
</ul>
</li>
</ol>
<p>使用 C++ 实现如下</p>
<pre class="z-code"><code><span class="z-text z-plain">void extend_window(const char *str, int str_len, int left, int &amp;right) {
</span><span class="z-text z-plain">    // S[0:right-left] == S[left:right]   closed interval
</span><span class="z-text z-plain">    // if S[0] != S[right], resulting in  left+1==right, indicating an empty range
</span><span class="z-text z-plain">    while (right &lt; str_len &amp;&amp; str[right - left] == str[right]) {
</span><span class="z-text z-plain">        ++right;
</span><span class="z-text z-plain">    }
</span><span class="z-text z-plain">    --right;
</span><span class="z-text z-plain">}
</span><span class="z-text z-plain">void z_function(const char *str, int str_len, int Z[]) {
</span><span class="z-text z-plain">    Z[0] = 0;
</span><span class="z-text z-plain">    int left = -1;
</span><span class="z-text z-plain">    int right = -1;
</span><span class="z-text z-plain">    for (int i=1; i &lt; str_len; ++i) {
</span><span class="z-text z-plain">        if (i &gt; right) {
</span><span class="z-text z-plain">            left = right = i;
</span><span class="z-text z-plain">            extend_window(str, str_len, left, right);
</span><span class="z-text z-plain">            Z[i] = right - left + 1;
</span><span class="z-text z-plain">        } else {
</span><span class="z-text z-plain">            int k = i - left;
</span><span class="z-text z-plain">            // We know S[0:right-left]  ==  S[left:right] =&gt;
</span><span class="z-text z-plain">            //      1. S[0:k]           ==  S[left:i]
</span><span class="z-text z-plain">            //      2. S[k, right-left] ==  S[i:right]
</span><span class="z-text z-plain">            if (Z[k] &lt; right - i + 1) {
</span><span class="z-text z-plain">                // exist p&gt;=0, S[k+p] != S[p] =&gt; S[i+p] != S[p]
</span><span class="z-text z-plain">                Z[i] = Z[k];
</span><span class="z-text z-plain">            } else {
</span><span class="z-text z-plain">                left = i;
</span><span class="z-text z-plain">                extend_window(str, str_len, left, right);
</span><span class="z-text z-plain">                Z[i] = right - left + 1;
</span><span class="z-text z-plain">            }
</span><span class="z-text z-plain">        }
</span><span class="z-text z-plain">    }
</span><span class="z-text z-plain">}
</span></code></pre>
<p><a rel="noopener" target="_blank" href="https://catalog.utdallas.edu/2019/graduate/courses/cs6333">UT Dallas CS 6333</a> 提供了一个直观的<a rel="noopener" target="_blank" href="https://personal.utdallas.edu/~besp/demo/John2010/z-algorithm.htm">网页演示</a>。</p>
<h4 id="hou-ji">后记</h4>
<p>介绍 Z Function 的英文文章不少，但我个人感觉 <a rel="noopener" target="_blank" href="https://www.hackerearth.com/practice/algorithms/string-algorithm/z-algorithm/tutorial/">HackerEarth</a> 的描述最为清晰。</p>
<p>Z Function 的英文定义可以参考 <a rel="noopener" target="_blank" href="https://contest.cs.cmu.edu/295/tutorials/z-string-matching.pdf">CMU 295 z-string-matching Page 7</a></p>
<p><a rel="noopener" target="_blank" href="https://cp-algorithms.com/string/z-function.html">e-maxx</a> 提供了若干道例题，如 <a rel="noopener" target="_blank" href="https://codeforces.com/problemset/problem/126/B">Codeforces - Password</a>. <a rel="noopener" target="_blank" href="https://discuss.codechef.com/t/z-algorithm-tutorial/64274">Codechef 的教程</a>也举出了两道例题。</p>
<p><a rel="noopener" target="_blank" href="https://github.com/resilar">resilar</a> 提供了<a rel="noopener" target="_blank" href="https://gist.github.com/resilar/e65745cf7a80ef364df034e96cfcc86d#file-z-c-L82">更为精简的实现</a>。</p>
<p><a rel="noopener" target="_blank" href="https://personal.utdallas.edu/~besp/demo/John2010/z-algorithm.htm">UT Dallas 的课程页面</a> 和 <a rel="noopener" target="_blank" href="https://github.com/raywenderlich/swift-algorithm-club/blob/2fdd8b8be1b3fcd17ad0394053e672f2bd1d3076/Z-Algorithm/README.markdown">Matteo Dunnhofer 的文章</a> 都提到了 <a rel="noopener" target="_blank" href="https://www.worldcat.org/title/algorithms-on-strings-trees-and-sequences-computer-science-and-computational-biology/oclc/910017234">Gusfield, Dan. Algorithms on Strings, Trees, and Sequences: Computer Science and Computational Biology</a>. 但我手头并没有这本书，并没有验证 Gusfield 的书上是否提到了这一算法。</p>
<p>非常感谢 ITX351 对本文提供的宝贵意见。</p>

      <nav>
        <div>
          <a href="https://blog.zhenbo.pro/solution-codeforces-723-1526e-oolimry-and-suffix-array/">&#8249; Codeforces #723 1526E Oolimry and Suffix Array 题解</a>
        </div>
        <div>
          <a href="https://blog.zhenbo.pro/tail-sum-formula-notes/"> Tail Sum Formula 的学习笔记 &#8250;</a>
        </div>
      </nav>
    </article>
  </main>
  <footer>
    <div class="c">
      <nav class="tpad"><div><a type="application/atom+xml" href="https://blog.zhenbo.pro/atom.xml" target="_blank" title="Blog of Endle Atom Feed"><i type="Button" class="svg rss" title="Blog of Endle Atom Feed"></i></a><a href="https://fediscience.org/@zhenboli" target="_blank" title="Mastodon" rel="me"><i type="Button" class="svg mastodon" title="Mastodon"></i></a><a href="https://matrix.to&#x2F;#&#x2F;@zhenbo:matrix.org/" target="_blank" title="Element"><i type="Button" class="svg element" title="Element"></i></a><a href="https://github.com/Endle/" target="_blank" title="Github"><i type="Button" class="svg github" title="Github"></i></a></div></nav>
      <nav class="vpad">
        <a class="rpad s90" href="https://blog.zhenbo.pro/about/"> About </a>
        <a class="rpad s90" href="https://blog.zhenbo.pro/links/"> Links </a>
        <a class="rpad s90" href="https://blog.zhenbo.pro/sitemap.xml" target="_blank"> Sitemap </a>
      </nav>
          
      <p class="s80"> <span id="year">2025</span> Blog of Endle • Website content is licensed <a rel="noopener" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>.</p>
      <p class="s80">Powered by <a href="https://www.getzola.org/" target="_blank">Zola</a> & <a href="https://github.com/jieiku/abridge/" target="_blank">Abridge</a></p>
    </div>
  </footer><span class="topout">
<span class="topleft"> </span><a href="#" class="top" title="Back to Top"><i class="svgs svgh angu"></i></a>
</span>
</body>
</html>
