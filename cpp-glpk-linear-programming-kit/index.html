
<!DOCTYPE html>
<html lang="en">
<head>
  <script src="https://blog.zhenbo.pro/js/theme.min.js" integrity="sha384-pb++s6uBRKaQv+iAXpgA/H3IlpLZdO14tTwuCI7uXmz4aaZdByoCcM+6BhynMq/1"></script>
  <link rel="stylesheet" href="https://blog.zhenbo.pro/abridge.css?h=d6d42eaae519f2454d3a" />
  <meta charset="utf-8" />
  <meta http-equiv="x-ua-compatible" content="ie=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="base" content="https://blog.zhenbo.pro" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <meta name="theme-color" content="#333333" />
  <meta name="msapplication-TileColor" content="#333333" />
  <link rel="manifest" href="https://blog.zhenbo.pro/manifest.min.json" />
  <link rel="mask-icon" href="https://blog.zhenbo.pro/safari-pinned-tab.svg" color="#ff9900" />
  <link rel="apple-touch-icon" sizes="180x180" href="https://blog.zhenbo.pro/apple-touch-icon.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="https://blog.zhenbo.pro/favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="https://blog.zhenbo.pro/favicon-16x16.png" />
  <link rel="alternate" type="application/atom+xml" title="Blog of Endle Atom Feed" href="https://blog.zhenbo.pro/atom.xml" />
  <meta name="robots" content="index, follow" />
  <meta name="googlebot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" />
  <meta name="bingbot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" />
  <title>在 C++ 中使用 GLPK 求解线性规划 | Blog of Endle</title>
  <meta name="author" content="Zhenbo Li" />
  <meta name="copyright" content="Blog of Endle" />
  <meta name="description" content="怎么使用 GLPK (GNU Linear Programming Kit)" />
  <link rel="canonical" href="https://blog.zhenbo.pro/cpp-glpk-linear-programming-kit/" />
  <meta property="og:url" content="https://blog.zhenbo.pro/cpp-glpk-linear-programming-kit/" />
  <meta name="twitter:url" content="https://blog.zhenbo.pro/cpp-glpk-linear-programming-kit/" />
  <meta property="og:description" content="怎么使用 GLPK (GNU Linear Programming Kit)" />
  <meta name="twitter:description" content="怎么使用 GLPK (GNU Linear Programming Kit)" />
  <meta property="og:title" content="在 C++ 中使用 GLPK 求解线性规划 | Blog of Endle" />
  <meta name="twitter:title" content="在 C++ 中使用 GLPK 求解线性规划 | Blog of Endle" />
  <meta name="twitter:card" content="summary" />
  <meta property="og:site_name" content="Blog of Endle" />
  <meta property="og:locale" content="en_US" />
  <meta property="og:type" content="website" />
  <meta property="og:updated_time" content="2018-02-12" />
  <script defer src="https://blog.zhenbo.pro/js/abridge.min.js?h=e0f9a881a665c86cce9c" integrity="sha384-QF67y7RnPkuDrJNQqn3/7nYxqxWkW/qHI7zN0WTES1aXbf+TotoByRBb835fUE6U"></script>
  <noscript><link rel="stylesheet" href="https://blog.zhenbo.pro/nojs.css" /></noscript><script>
MathJax = {
  tex: {
    inlineMath: [['$', '$'], ['\\(', '\\)']]
  },
  svg: {
    fontCache: 'global'
  }
};
</script>
<script type="text/javascript" id="MathJax-script" defer
  src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-svg.js">
</script>

  
</head>
<body>
  <header>
    <nav>
      <div><big><a href="https://blog.zhenbo.pro" title="Blog of Endle">Blog of Endle</a></big></div>
      <div>

        <div>
          <ul><li><a class="s110" href="https://blog.zhenbo.pro/archive/"> Posts </a></li><li><i type="reset" id="mode" class="js svgs adjust"></i></ul>
        </div>

        <div>
          <div>
            <form autocomplete=off class="js" name="goSearch" id="searchbox">
              <div class="searchd">
                <input id="searchinput" type="text" placeholder="Search" title="Search" />
                <button type="submit" title="Search" class="svgs svgm search"></button>
              </div>
              <div class="results"><div id="suggestions"></div></div>
            </form>
          </div>
        </div>

      </div>
    </nav>
  </header>
  <main>
    <article>
      <h1><a href="https://blog.zhenbo.pro/cpp-glpk-linear-programming-kit/">在 C++ 中使用 GLPK 求解线性规划</a></h1>

      <span class="s95"> Zhenbo Li <span class="rpad"></span> February 12, 2018 <span class="rpad"></span></span>

    


<p>最近，参加了一个提交答案类的编程比赛，有一道题可用线性规划解决。搜索发现，<a rel="noopener" target="_blank" href="https://www.gnu.org/software/glpk">GLPK (GNU Linear Programming Kit)</a> 是一个免费的线性规划计算库，可以方便地被 C/C++ 代码调用。现将基本使用方法整理如下：</p>
<h2 id="zhun-bei-gong-zuo">准备工作</h2>
<h4 id="an-zhuang-glpk">安装 GLPK</h4>
<p>多数的发行版都应该提供了 <a rel="noopener" target="_blank" href="https://www.gnu.org/software/glpk">GLPK</a> 的包。在 Fedora 下，只需运行<br />
<code>sudo dnf install glpk glpk-devel</code></p>
<h4 id="bian-yi-glpk">编译 GLPK</h4>
<p>Fedora 将 <code>glpk.h</code> 存在了 <code>/usr/include/glpk.h</code>，因此，不需添加指令即可找到头文件。如果你是手动编译安装的 <a rel="noopener" target="_blank" href="https://www.gnu.org/software/glpk">GLPK</a>，那可能需要使用 <code>-I</code> 指定头文件目录。链接的指令为 <code>-lglpk</code>。如果使用的是 C++ 的话，在调用头文件时，记得声明 <code>extern</code>。你可以试着使用 <code>g++ -lglpk test.cpp</code> 编译如下代码</p>
<p>{% highlight C %}
#include <iostream>
extern "C"{
#include "glpk.h"
}
int main()
{
std::cout &lt;&lt; glp_version() &lt;&lt; std::endl;
return 0;
}
{% endhighlight %}</p>
<p>在我撰写本文时（2018年2月初），<a rel="noopener" target="_blank" href="https://www.gnu.org/software/glpk">GLPK</a> 的版本应当为 4.61。</p>
<h2 id="shi-zhan-yan-lian">实战演练</h2>
<p><a rel="noopener" target="_blank" href="https://www.gnu.org/software/glpk">GLPK</a> 官方手册上的例子有点让人混淆。在这里，我将采用更精简的例子。<br />
Maximize
\[z=10x_1+6x_2\]
Subject to
\[x_1+x_2\leqslant200\]
\[x_1+2x_2\geqslant10\]
\[3x_1+x_2\leqslant275.5\]
where all variables are non-negative
\[x_1\geqslant 0, x_2\geqslant 0\]</p>
<p>对于三个约束条件，我们可以创建三个辅助变量(auxiliary variables)，将问题转化为如下形式：<br />
Maximize
\[z=10x_1+6x_2\]
Subject to
\[p=x_1+x_2\]
\[q=x_1+2x_2\]
\[r=3x_1+x_2\]
where all variables are non-negative
\[x_1\geqslant 0, x_2\geqslant 0\]
\[0\leqslant p\leqslant200,q\geqslant10,0\leqslant r\leqslant275.5\]</p>
<p>现在，可以将我们的问题输入程序了。<a rel="noopener" target="_blank" href="https://www.gnu.org/software/glpk">GLPK</a> 将各辅助变量看作行(row)，将原有的变量看作列(column)，用一个矩阵表示辅助变量和原有变量的关系。</p>
<p>{% highlight c %}
#include <cstdio>
extern "C"{
#include "glpk.h"
}</p>
<p>int main() {
initialize:
glp_prob *lp;
lp = glp_create_prob();
glp_set_obj_dir(lp, GLP_MAX);
auxiliary_variables_rows:
glp_add_rows(lp, 3);
glp_set_row_name(lp, 1, "p");
glp_set_row_bnds(lp, 1, GLP_DB, 0.0, 200.0);
glp_set_row_name(lp, 2, "q");
glp_set_row_bnds(lp, 2, GLP_LO, 10.0, 0.0);
glp_set_row_name(lp, 3, "r");
glp_set_row_bnds(lp, 3, GLP_DB, 0.0, 275.5);</p>
<p>variables_columns:
glp_add_cols(lp, 2);
glp_set_col_name(lp, 1, "x1");
glp_set_col_bnds(lp, 1, GLP_LO, 0.0, 0.0);
glp_set_col_name(lp, 2, "x2");
glp_set_col_bnds(lp, 2, GLP_LO, 0.0, 0.0);
to_maximize:
glp_set_obj_coef(lp, 1, 10.0);
glp_set_obj_coef(lp, 2, 6.0);</p>
<p>constrant_matrix:
int ia[7], ja[7];
double ar[7];
ia[1] = 1, ja[1] = 1, ar[1] = 1;
ia[2] = 1, ja[2] = 2, ar[2] = 1; // p = x1 + x2
ia[3] = 2, ja[3] = 1, ar[3] = 1;
ia[4] = 2, ja[4] = 2, ar[4] = 2; // q = x1 + 2x2
ia[5] = 3, ja[5] = 1, ar[5] = 3;
ia[6] = 3, ja[6] = 2, ar[6] = 1; // r = 3x1 + x2
glp_load_matrix(lp, 6, ia, ja, ar);</p>
<p>calculate:
glp_simplex(lp, NULL);</p>
<p>output:
double z, x1, x2;
z = glp_get_obj_val(lp);
x1 = glp_get_col_prim(lp, 1);
x2 = glp_get_col_prim(lp, 2);
printf("z = %lf, x1 = %lf, x2 = %lf\n", z, x1, x2);</p>
<p>cleanup:
glp_delete_prob(lp);
return 0;
}
/*
GLPK Simplex Optimizer, v4.61
3 rows, 2 columns, 6 non-zeros
0: obj =  -0.000000000e+00 inf =   1.000e+01 (1)
1: obj =   3.000000000e+01 inf =   0.000e+00 (0)</p>
<ul>
<li><pre class="z-code"><code><span class="z-text z-plain">4: obj =   1.351000000e+03 inf =   0.000e+00 (0)
</span></code></pre>
</li>
</ul>
<p>OPTIMAL LP SOLUTION FOUND
z = 1351.000000, x1 = 37.750000, x2 = 162.250000
*/
{% endhighlight %}</p>
<p>第一次看到示例代码，对于 <code>constrant_matrix</code> 部分可能会比较费解。在这里，<code>ia</code> 表示行号(第几个辅助变量)，<code>ja</code> 表示列号(第几个变量)，而 <code>ar</code> 的类型是 <code>double</code>，表示 constrant matrix 中的系数。将这些条件成功导入后，使用 <code>glp_simplex</code> 就可以求解了。</p>
<p>一个常见的需求是，需要求出对应的<strong>整数解</strong>。使用 glpk，这一问题也很好解决。<br />
{% highlight c %}
set_variables_to_integer:
glp_set_col_kind(lp, 1, GLP_IV);
glp_set_col_kind(lp, 2, GLP_IV);
calculate:
glp_simplex(lp, NULL);
glp_intopt(lp, NULL);
output:
double z, x1, x2;
z = glp_mip_obj_val(lp);
x1 = glp_mip_col_val(lp, 1);
x2 = glp_mip_col_val(lp, 2);
printf("z = %lf, x1 = %lf, x2 = %lf\n", z, x1, x2);
/*
GLPK Simplex Optimizer, v4.61
3 rows, 2 columns, 6 non-zeros
0: obj =  -0.000000000e+00 inf =   1.000e+01 (1)
1: obj =   3.000000000e+01 inf =   0.000e+00 (0)</p>
<ul>
<li><pre class="z-code"><code><span class="z-text z-plain">4: obj =   1.351000000e+03 inf =   0.000e+00 (0)
</span></code></pre>
</li>
</ul>
<p>OPTIMAL LP SOLUTION FOUND
GLPK Integer Optimizer, v4.61
3 rows, 2 columns, 6 non-zeros
2 integer variables, none of which are binary
Integer optimization begins...</p>
<ul>
<li><pre class="z-code"><code><span class="z-text z-plain">4: mip =     not found yet &lt;=              +inf        (1; 0)
</span></code></pre>
</li>
</ul>
<p>Solution found by heuristic: 1346</p>
<ul>
<li><pre class="z-code"><code><span class="z-text z-plain">6: &gt;&gt;&gt;&gt;&gt;   1.348000000e+03 &lt;=   1.348000000e+03   0.0% (1; 1)
</span></code></pre>
</li>
<li><pre class="z-code"><code><span class="z-text z-plain">6: mip =   1.348000000e+03 &lt;=     tree is empty   0.0% (0; 3)
</span></code></pre>
</li>
</ul>
<p>INTEGER OPTIMAL SOLUTION FOUND
z = 1348.000000, x1 = 37.000000, x2 = 163.000000
*/
{% endhighlight %}</p>
<p>在运行过<code>glp_simplex</code>后，再运行<code>glp_intopt</code>即可得到整数解。但要注意的是，提取整数解的命令是 <code>glp_mip_obj_val</code> /
<code>glp_mip_col_val</code>。</p>
<p>PS 写这篇 blog 时，我第一次使用了 <a rel="noopener" target="_blank" href="http://www.gastonsanchez.com/visually-enforced/opinion/2014/02/16/Mathjax-with-jekyll/">mathjax</a>。只能说，写作体验超乎想象地好。</p>
<p style="color:grey">讲一个逸闻吧。之前我曾把线性规划和高斯消元的时间复杂度弄混了，以至于我成功将大量NP问题转化为了线性规划问题后得到了“多项式”的解。</p>
<p>{% include mathjax.html %}</p>

      <nav>
        <div>
          <a href="https://blog.zhenbo.pro/distcc-to-speedup/">&#8249; 用 distcc 加快编译</a>
        </div>
        <div>
          <a href="https://blog.zhenbo.pro/use-latex-for-boring-job/"> 用牛刀 LaTeX 完成简单的排版任务 &#8250;</a>
        </div>
      </nav>
    </article>
  </main>
  <footer>
    <div class="c">
      <nav class="tpad"><div><a type="application/atom+xml" href="https://blog.zhenbo.pro/atom.xml" target="_blank" title="Blog of Endle Atom Feed"><i type="Button" class="svg rss" title="Blog of Endle Atom Feed"></i></a><a href="https://fediscience.org/@zhenboli" target="_blank" title="Mastodon" rel="me"><i type="Button" class="svg mastodon" title="Mastodon"></i></a><a href="https://matrix.to&#x2F;#&#x2F;@zhenbo:matrix.org/" target="_blank" title="Element"><i type="Button" class="svg element" title="Element"></i></a><a href="https://github.com/Endle/" target="_blank" title="Github"><i type="Button" class="svg github" title="Github"></i></a></div></nav>
      <nav class="vpad">
        <a class="rpad s90" href="https://blog.zhenbo.pro/about/"> About </a>
        <a class="rpad s90" href="https://blog.zhenbo.pro/links/"> Links </a>
        <a class="rpad s90" href="https://blog.zhenbo.pro/sitemap.xml" target="_blank"> Sitemap </a>
      </nav>
          
      <p class="s80"> <span id="year">2025</span> Blog of Endle • Website content is licensed <a rel="noopener" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>.</p>
      <p class="s80">Powered by <a href="https://www.getzola.org/" target="_blank">Zola</a> & <a href="https://github.com/jieiku/abridge/" target="_blank">Abridge</a></p>
    </div>
  </footer><span class="topout">
<span class="topleft"> </span><a href="#" class="top" title="Back to Top"><i class="svgs svgh angu"></i></a>
</span>
</body>
</html>
